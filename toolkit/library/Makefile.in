# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this file,
# You can obtain one at http://mozilla.org/MPL/2.0/.

include $(topsrcdir)/toolkit/library/libxul.mk

include $(topsrcdir)/config/config.mk

# Wrap linker to print linking status periodically to prevent the linking
# process from getting killed
EXPAND_LIBS_EXEC := $(PYTHON) $(topsrcdir)/config/link.py

include $(topsrcdir)/config/rules.mk

.PHONY: gtestxul
gtestxul:
	$(MAKE) -C $(DEPTH) toolkit/library/gtest/target LINK_GTEST_DURING_COMPILE=1

ifneq (,$(filter -DTT_MEMUTIL,$(MOZ_OPTIMIZE_FLAGS)))
ifeq ($(OS_ARCH)_$(GNU_CC),WINNT_1)
ifneq ($(OS_ARCH)$(OS_TEST),WINNTx86_64)
LDFLAGS += -Wl,-u__imp__memset_nontemporal_tt -lportable32
else
LDFLAGS += -Wl,-u__imp_memset_nontemporal_tt -lportable64
endif
endif

ifdef _MSC_VER
ifneq (64,$(findstring 64,$(OS_TEST)))
LDFLAGS += -INCLUDE:"__imp__memset_nontemporal_tt" portable32.lib
else
LDFLAGS += -INCLUDE:"__imp_memset_nontemporal_tt" portable64.lib
endif
endif
endif
